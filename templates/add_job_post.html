{% extends 'base.html' %}
{% block title %}Add Job Post - Management{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Add Job Post</h1>
      <a href="{% url 'job_posts_list' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to List
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Create New Job Post</h3>
        </div>
        <div class="card-body">
          <!-- Display Messages -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="POST" id="jobPostForm">
            {% csrf_token %}
            
            <!-- Company Selection -->
            <div class="form-group">
              <label for="company_id">Company *</label>
              <select class="form-control" id="company_id" name="company_id" required>
                <option value="">-- Select Company --</option>
                {% for comp in companies %}
                <option value="{{ comp.md5_id }}">{{ comp.name }} ({{ comp.email }})</option>
                {% endfor %}
              </select>
              <small class="form-text text-muted">Select the company that is posting this job</small>
            </div>

            <!-- Job Title -->
            <div class="form-group">
              <label for="job_title">Job Title *</label>
              <input type="text" class="form-control" id="job_title" name="job_title" required 
                     placeholder="e.g., Senior Software Engineer" maxlength="255">
            </div>

            <!-- Job Description -->
            <div class="form-group">
              <label for="job_description">Job Description *</label>
              <textarea class="form-control" id="job_description" name="job_description" 
                        rows="5" required placeholder="Describe the job responsibilities, role, etc."></textarea>
            </div>

            <!-- Requirements -->
            <div class="form-group">
              <label for="requirements">Requirements</label>
              <textarea class="form-control" id="requirements" name="requirements" 
                        rows="4" placeholder="List the required skills, qualifications, experience, etc."></textarea>
            </div>

            <div class="row">
              <!-- Location -->
              <div class="col-md-6">
                <div class="form-group">
                  <label for="location">Location</label>
                  <input type="text" class="form-control" id="location" name="location" 
                         placeholder="e.g., New York, NY or Remote" maxlength="255">
                </div>
              </div>

              <!-- Salary Range -->
              <div class="col-md-6">
                <div class="form-group">
                  <label for="salary_range">Salary Range</label>
                  <input type="text" class="form-control" id="salary_range" name="salary_range" 
                         placeholder="e.g., $80,000 - $120,000" maxlength="100">
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Employment Type -->
              <div class="col-md-6">
                <div class="form-group">
                  <label for="employment_type">Employment Type</label>
                  <select class="form-control" id="employment_type" name="employment_type">
                    <option value="">-- Select Type --</option>
                    {% for value, label in employment_types %}
                    <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <!-- Application Deadline -->
              <!-- <div class="col-md-6">
                <div class="form-group">
                  <label for="application_deadline">Application Deadline</label>
                  <input type="date" class="form-control" id="application_deadline" name="application_deadline">
                  <small class="form-text text-muted">Leave empty if no deadline</small>
                </div>
              </div>
            </div> -->

            <!-- Status -->
            <!-- <div class="form-group"> -->
              <!-- <label for="status">Status</label>
              <select class="form-control" id="status" name="status">
                <option value="1" selected>Active</option>
                <option value="0">Inactive</option>
              </select>
              <small class="form-text text-muted">Active jobs will be visible to users</small>
            </div> -->

            <!-- Form Actions -->
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Create Job Post
              </button>
              <a href="{% url 'job_posts_list' %}" class="btn btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  // Form validation
  $('#jobPostForm').on('submit', function(e) {
    const companyId = $('#company_id').val();
    const jobTitle = $('#job_title').val().trim();
    
    if (!companyId) {
      e.preventDefault();
      alert('Please select a company');
      $('#company_id').focus();
      return false;
    }
    
    if (!jobTitle) {
      e.preventDefault();
      alert('Please enter a job title');
      $('#job_title').focus();
      return false;
    }
    
    // Optional: Add more validation as needed
    return true;
  });

  // Set minimum date for application deadline to today
  const today = new Date().toISOString().split('T')[0];
  $('#application_deadline').attr('min', today);

  // Auto-save functionality (optional)
  let formChanged = false;
  $('#jobPostForm').on('change', function() {
    formChanged = true;
  });

  // Warn user if they try to leave with unsaved changes
  $(window).on('beforeunload', function() {
    if (formChanged) {
      return 'You have unsaved changes. Are you sure you want to leave?';
    }
  });

  // Reset form changed flag when form is submitted
  $('#jobPostForm').on('submit', function() {
    formChanged = false;
  });
});
</script>

<style>
.form-group {
  margin-bottom: 1.5rem;
}

label {
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.form-control:focus {
  border-color: #4e73df;
  box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
}

.required::after {
  content: " *";
  color: #e74a3b;
}

.card {
  box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
  border: 1px solid #e3e6f0;
}

.card-header {
  background-color: #f8f9fc;
  border-bottom: 1px solid #e3e6f0;
}
</style>
{% endblock %}