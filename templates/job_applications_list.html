{% extends 'base.html' %}
{% block title %}Job Applications - Management{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Job Applications Management</h1>
      <a href="{% url 'add_job_application' %}" class="btn btn-primary">
        <i class="fas fa-user-plus"></i> Add Application
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">All Job Applications</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="jobApplicationsTable" class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Applicant Name</th>
                  <th>Applicant Email</th>
                  <th>Job Title</th>
                  <th>Company</th>
                  <th>Applied At</th>
                  <th>Status</th>
                  <th>Resume</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be populated by DataTables via AJAX -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  $('#jobApplicationsTable').DataTable({
    processing: true,
    serverSide: true,
    ajax: {
      url: "{% url 'job_applications_data' %}",
      type: 'GET',
      dataSrc: 'data',
      error: function(xhr, error, thrown) {
        console.log('DataTables error:', error);
        console.log('Response:', xhr.responseText);
      }
    },
    columns: [
      { data: "applicant_name" },
      { data: "applicant_email" },
      { data: "job_title" },
      { data: "company" },
      { data: "applied_at" },
      { data: "status" },
      { 
        data: "resume", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      },
      { 
        data: "actions", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      }
    ],
    language: {
      processing: "<i class='fas fa-spinner fa-spin'></i> Processing...",
      search: "_INPUT_",
      searchPlaceholder: "Search applications...",
      lengthMenu: "Show _MENU_ applications per page",
      info: "Showing _START_ to _END_ of _TOTAL_ applications",
      infoEmpty: "Showing 0 to 0 of 0 applications",
      infoFiltered: "(filtered from _MAX_ total applications)",
      zeroRecords: "No matching applications found",
      paginate: {
        first: "<i class='fas fa-angle-double-left'></i>",
        last: "<i class='fas fa-angle-double-right'></i>",
        next: "<i class='fas fa-angle-right'></i>",
        previous: "<i class='fas fa-angle-left'></i>"
      }
    },
    pageLength: 10,
    lengthMenu: [[5, 10, 25, 50, 100], [5, 10, 25, 50, 100]],
    responsive: true,
    ordering: true,
    order: [[4, 'desc']], // Order by applied_at descending
    searchDelay: 500
  });
});
</script>
{% endblock %}