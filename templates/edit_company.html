{% extends 'base.html' %}
{% block title %}Edit Company - {{ company_obj.name }}{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Edit Company</h3>
          <div class="card-tools">
            <a href="{% url 'companies' %}" class="btn btn-secondary btn-sm">
              <i class="fas fa-arrow-left"></i> Back to Companies
            </a>
          </div>
        </div>
        <div class="card-body">
          <!-- Messages -->
          {% if messages %}
          <div class="mb-4">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <form method="POST">
            {% csrf_token %}
            
            <div class="row">
              <div class="col-md-6">
                <!-- Company Name -->
                <div class="form-group mb-3">
                  <label for="name" class="form-label">Company Name *</label>
                  <input type="text" class="form-control" id="name" name="name" 
                         value="{{ company_obj.name }}" required>
                  <div class="form-text">The official name of the company</div>
                </div>

                <!-- Email -->
                <div class="form-group mb-3">
                  <label for="email" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="email" name="email" 
                         value="{{ company_obj.email }}" required>
                  <div class="form-text">Primary contact email</div>
                </div>

                <!-- Phone Number -->
                <div class="form-group mb-3">
                  <label for="phone_no" class="form-label">Phone Number</label>
                  <input type="text" class="form-control" id="phone_no" name="phone_no" 
                         value="{{ company_obj.phone_no }}">
                  <div class="form-text">Company contact number</div>
                </div>
              </div>

              <div class="col-md-6">
                <!-- Website -->
                <div class="form-group mb-3">
                  <label for="website" class="form-label">Website</label>
                  <input type="url" class="form-control" id="website" name="website" 
                         value="{{ company_obj.website|default:'' }}">
                  <div class="form-text">Company website URL</div>
                </div>

                <!-- Status (if you want to include it) -->
                <div class="form-group mb-3">
                  <label for="status" class="form-label">Status</label>
                  <select class="form-control" id="status" name="status">
                    <option value="1" {% if company_obj.status == '1' %}selected{% endif %}>Active</option>
                    <option value="0" {% if company_obj.status == '0' %}selected{% endif %}>Inactive</option>
                    <!-- <option value="5" {% if company_obj.status == '5' %}selected{% endif %}>Deleted</option> -->
                  </select>
                  <div class="form-text text-muted">Set company status</div>
                </div>

                <!-- System Info (Read-only) -->
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-title">System Information</h6>
                    <small class="text-muted">
                        <br>
                      <strong>Created:</strong> {{ company_obj.created_at|date:"M d, Y H:i" }}<br>
                      <strong>Last Updated:</strong> 
                      {% if company_obj.updated_at %}
                        {{ company_obj.updated_at|date:"M d, Y H:i" }}
                      {% else %}
                        Never
                      {% endif %}
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Address -->
            <div class="row">
              <div class="col-12">
                <div class="form-group mb-3">
                  <label for="address" class="form-label">Address</label>
                  <textarea class="form-control" id="address" name="address" 
                            rows="3" placeholder="Enter company address">{{ company_obj.address|default:'' }}</textarea>
                  <div class="form-text">Full company address</div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-flex justify-content-between">
                  <div>
                    <a href="{% url 'company_details' company_obj.md5_id %}" class="btn btn-info">
                      <i class="fas fa-eye"></i> View Details
                    </a>
                    <a href="{% url 'companies' %}" class="btn btn-secondary">
                      <i class="fas fa-times"></i> Cancel
                    </a>
                  </div>
                  <div>
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save"></i> Update Company
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  // Add form validation
  $('form').on('submit', function(e) {
    const name = $('#name').val().trim();
    const email = $('#email').val().trim();
    
    if (!name) {
      alert('Company name is required!');
      e.preventDefault();
      return;
    }
    
    if (!email) {
      alert('Email address is required!');
      e.preventDefault();
      return;
    }
    
    // Basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('Please enter a valid email address!');
      e.preventDefault();
      return;
    }
  });

  // Auto-format website URL
  $('#website').on('blur', function() {
    let url = $(this).val().trim();
    if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
      $(this).val('https://' + url);
    }
  });
});
</script>
{% endblock %}