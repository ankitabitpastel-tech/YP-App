{% extends 'base.html' %}
{% block title %}Articles Management - Management{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Articles Management</h1>
      <a href="{% url 'add_article' %}" class="btn btn-primary">
        <i class="fas fa-newspaper"></i> Add Article
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">All Articles</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="articlesTable" class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Company</th>
                  <th>Category</th>
                  <th>Image</th>
                  <th>Published At</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be populated by DataTables via AJAX -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  $('#articlesTable').DataTable({
    processing: true,
    serverSide: true,
    ajax: {
      url: "{% url 'articles_data' %}",
      type: 'GET',
      dataSrc: 'data',
      error: function(xhr, error, thrown) {
        console.log('DataTables error:', error);
        console.log('Response:', xhr.responseText);
      }
      
    },
    columns: [
      { data: "title" },
      { data: "company" },
      { data: "category" },
      { 
        data: "image", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      },
      { data: "published_at" },
      { 
        data: "actions", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      }
    ],
    language: {
      processing: "<i class='fas fa-spinner fa-spin'></i> Processing...",
      search: "_INPUT_",
      searchPlaceholder: "Search articles...",
      lengthMenu: "Show _MENU_ articles per page",
      info: "Showing _START_ to _END_ of _TOTAL_ articles",
      infoEmpty: "Showing 0 to 0 of 0 articles",
      infoFiltered: "(filtered from _MAX_ total articles)",
      zeroRecords: "No matching articles found",
      paginate: {
        first: "<i class='fas fa-angle-double-left'></i>",
        last: "<i class='fas fa-angle-double-right'></i>",
        next: "<i class='fas fa-angle-right'></i>",
        previous: "<i class='fas fa-angle-left'></i>"
      }
    },
    pageLength: 10,
    lengthMenu: [[5, 10, 25, 50, 100], [5, 10, 25, 50, 100]],
    responsive: true,
    ordering: true,
    order: [[3, 'desc']], // Order by published_at descending
    searchDelay: 500
  });
});
</script>
{% endblock %}