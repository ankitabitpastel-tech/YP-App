{% extends 'base.html' %}
{% block title %}Companies - Management{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Companies Management</h1>
      <a href="{% url 'add_company' %}" class="btn btn-primary">
        <i class="fas fa-building"></i> Add Company
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">All Companies</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="companiesTable" class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Company Name</th>
                  <th>Email</th>
                  <th>Phone No</th>
                  <th>Website</th>  <!-- FIXED: website (not webside) -->
                  <th>Address</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be populated by DataTables via AJAX -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  $('#companiesTable').DataTable({
    processing: true,
    serverSide: true,
    ajax: {
      url: "{% url 'companies_data' %}",
      type: 'GET',
      dataSrc: 'data',
      error: function(xhr, error, thrown) {
        console.log('DataTables error:', error);
        console.log('Response:', xhr.responseText);
      }
    },
    columns: [
      { data: "name" },
      { data: "email" },
      { data: "phone_no" },  
      { data: "website" },   <!-- FIXED: website (not webside) -->
      { data: "address" },
      { 
        data: "actions", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      }
    ],
    language: {
      processing: "<i class='fas fa-spinner fa-spin'></i> Processing...",
      search: "_INPUT_",
      searchPlaceholder: "Search companies...",
      lengthMenu: "Show _MENU_ companies per page",
      info: "Showing _START_ to _END_ of _TOTAL_ companies",
      infoEmpty: "Showing 0 to 0 of 0 companies",
      infoFiltered: "(filtered from _MAX_ total companies)",
      zeroRecords: "No matching companies found",
      paginate: {
        first: "<i class='fas fa-angle-double-left'></i>",
        last: "<i class='fas fa-angle-double-right'></i>",
        next: "<i class='fas fa-angle-right'></i>",
        previous: "<i class='fas fa-angle-left'></i>"
      }
    },
    pageLength: 10,
    lengthMenu: [[5, 10, 25, 50, 100], [5, 10, 25, 50, 100]],
    responsive: true,
    ordering: true,
    searchDelay: 500
  });
});
</script>
{% endblock %}