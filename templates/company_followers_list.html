{% extends 'base.html' %}
{% block title %}Company Followers - Management{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Company Followers Management</h1>
      <a href="{% url 'add_company_follower' %}" class="btn btn-primary">
        <i class="fas fa-user-plus"></i> Add Follower
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">All Company Followers</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="companyFollowersTable" class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>User Name</th>
                  <th>User Email</th>
                  <th>Company Name</th>
                  <th>Company Email</th>
                  <th>Followed At</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be populated by DataTables via AJAX -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
  $('#companyFollowersTable').DataTable({
    processing: true,
    serverSide: true,
    ajax: {
      url: "{% url 'company_followers_data' %}",
      type: 'GET',
      dataSrc: 'data',
      error: function(xhr, error, thrown) {
        console.log('DataTables error:', error);
        console.log('Response:', xhr.responseText);
      }
    },
    columns: [
      { data: "user_name" },
      { data: "user_email" },
      { data: "company_name" },
      { data: "company_email" },
      { data: "updated_at" },
      { data: "status" },
      { 
        data: "actions", 
        orderable: false, 
        searchable: false,
        className: 'text-center'
      }
    ],
    language: {
      processing: "<i class='fas fa-spinner fa-spin'></i> Processing...",
      search: "_INPUT_",
      searchPlaceholder: "Search followers...",
      lengthMenu: "Show _MENU_ followers per page",
      info: "Showing _START_ to _END_ of _TOTAL_ followers",
      infoEmpty: "Showing 0 to 0 of 0 followers",
      infoFiltered: "(filtered from _MAX_ total followers)",
      zeroRecords: "No matching followers found",
      paginate: {
        first: "<i class='fas fa-angle-double-left'></i>",
        last: "<i class='fas fa-angle-double-right'></i>",
        next: "<i class='fas fa-angle-right'></i>",
        previous: "<i class='fas fa-angle-left'></i>"
      }
    },
    pageLength: 10,
    lengthMenu: [[5, 10, 25, 50, 100], [5, 10, 25, 50, 100]],
    responsive: true,
    ordering: true,
    order: [[0, 'asc']], 
    searchDelay: 500
  });
});
</script>
{% endblock %}